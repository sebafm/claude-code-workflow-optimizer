# Optimize System Documentation

## Overview

The Optimize System is a comprehensive code quality and architecture alignment framework consisting of integrated slash commands that work together to ensure continuous improvement of your codebase.

## System Architecture

### Test-First Optimization Workflow with GitHub Integration

```mermaid
graph LR
    A[/optimize] --> B[Test Impact Analysis]
    B --> C[/optimize-review] 
    C --> D[Test Updates]
    C --> G[GitHub Issues]
    D --> E[Implementation]
    E --> F[Test Validation]
    F --> H[Documentation]
    F --> I{Tests Pass?}
    I -->|No| J[Rollback & Fix]
    I -->|Yes| K[/optimize-status]
    J --> D
    K --> L[/optimize-gh-migrate?]
    L --> M[Clear Backlog]
    K --> A
```

## Complete Command System

The optimization system provides six integrated commands covering the full optimization lifecycle:

### `/optimize-setup` - Project Initialization
**Purpose:** One-time intelligent project setup and configuration
**Features:**
- **Project Analysis** - Automatic detection of languages, frameworks, testing tools
- **Agent Customization** - Project-specific agent configuration with contextual knowledge  
- **CLAUDE.md Integration** - Intelligent documentation integration with critical safety warnings
- **Directory Structure** - Complete `.claude/optimize/` system initialization
- **Configuration Generation** - Project-tailored optimization settings and templates

**Input:** None (interactive setup with intelligent defaults)
**Output:** 
- `.claude/optimize/config.json` (project configuration)
- `.claude/optimize/agents/` (customized agents with project context)
- `.claude/optimize/templates/` (issue and report templates)
- Updated `.claude/CLAUDE.md` with optimization system integration
**When to use:** First time setting up optimization system in a project
**Status:** "OPTIMIZATION SYSTEM INITIALIZED"

### `/optimize` - Analysis Phase
**Purpose:** Analyze code changes for quality, architecture, and security issues
**Features:**
- Multi-agent code analysis using project-customized agents
- Intelligent issue prioritization and categorization
- Test impact analysis and recommendations
- Integration with project configuration from setup

**Output:** 
- `.claude/optimize/pending/issues.json` (structured issues)
- `.claude/optimize/reports/optimization_DATE.md` (detailed report)
**Status:** "WAITING FOR REVIEW"

### `/optimize-review` - Decision Phase  
**Purpose:** Process user decisions and generate implementation commands
**Input Examples:** 
- Individual: `"Implement #1, #3, gh-issue #5, Skip #2, Defer #4"`
- Batch: `"Skip all"`, `"Implement all"`, `"gh-issue all"`, `"Defer all"`
- Mixed: `"Implement all critical, gh-issue all high, Defer the rest"`
**Output:**
- `.claude/optimize/pending/commands.sh` (subagent commands for implemented issues)
- GitHub issues created via gh CLI (for gh-issue selections)
- `.claude/optimize/backlog/deferred_issues.json` (deferred issues)
- `.claude/optimize/completed/skipped_issues.json` (permanently dismissed issues)
- `.claude/optimize/decisions/review_DATE.md` (decision tracking)
**Status:** "READY FOR IMPLEMENTATION"

### `/optimize-commit` - Attribution Phase
**Purpose:** Intelligent git commit integration with optimization session tracking
**Features:**
- **Session Discovery** - Automatic detection of recent optimization sessions
- **Issue Attribution** - Links commits to implemented optimization issues
- **Smart Commit Messages** - Context-aware commit message generation with issue details
- **Session Linking** - Bidirectional linking between commits and optimization sessions
- **Git Integration** - Handles staging, review, and commit workflow

**Input:** None (automatic session detection and user confirmation)
**Output:**
- Git commit with optimization-aware commit message
- Updated session files with commit references
- `.claude/optimize/decisions/commit_HASH_SESSION.md` (commit tracking)
**When to use:** After implementing optimizations to commit changes with full context
**Status:** "OPTIMIZATION IMPROVEMENTS COMMITTED"

### `/optimize-status` - Monitoring
**Purpose:** System overview and health monitoring
**Output:** Real-time status of pending, backlog, and completed issues

### `/optimize-gh-migrate` - GitHub Migration
**Purpose:** Convert deferred issues from backlog to GitHub issues
**Input Examples:**
- Individual: `"Convert #2, #4"`
- Batch: `"Convert all"`, `"Convert all high"`
**Output:** GitHub issues created, backlog cleared, migration tracking
**Status:** "BACKLOG MIGRATED TO GITHUB"

## File Structure

```
.claude/
├── agents/           # Your existing agents (preserved)
├── commands/         # Your existing commands (preserved)  
└── optimize/         # Optimization System (isolated)
    ├── pending/
    │   ├── issues.json          # Current issues awaiting review (generated by /optimize)
    │   └── commands.sh          # Ready-to-execute subagent commands (generated by /optimize-review)
    ├── backlog/
    │   └── deferred_issues.json # Issues postponed for later analysis (user deferred items)
    ├── completed/
    │   ├── implemented_*.json   # Archive of completed issues (timestamped records)
    │   └── skipped_issues.json  # Permanently dismissed issues
    ├── decisions/
    │   └── review_*.md          # Historical record of user decisions with comments (timestamped)
    └── reports/
        └── optimization_*.md    # Detailed analysis reports with findings (timestamped)

Note: All optimization files are isolated in .claude/optimize/ 
to avoid conflicts with your existing agents and commands.
```

### Integration with Subagents

### Analysis Subagents (used by `/optimize`)
- **@code-reviewer**: Code quality, performance, maintainability analysis
- **@database-architect**: Data access patterns and database optimization
- **@python-backend-architect**: Backend architecture and API alignment
- **@security-auditor**: Security vulnerabilities and best practices
- **@test-automation-engineer**: Test coverage analysis and test impact assessment
- **@task-decomposer**: Structure findings into actionable tasks with test considerations

### Implementation Subagents (called via `commands.sh`)
Generated commands follow test-first approach:
1. **Test Impact Analysis**: @test-automation-engineer analyzes which tests will be affected
2. **Test Updates**: Update/create tests before implementation begins
3. **Guided Implementation**: Other subagents implement changes with test safety guards
4. **Validation**: Automated test runs with failure handling
5. **Documentation**: @project-scribe documents successful optimizations only

**Test-First Command Pattern:**
```bash
@test-automation-engineer analyze-test-impact --issues='#1,#3'
@test-automation-engineer update-tests --test-plan='analysis.md'
@code-reviewer fix issue-#1 --test-guided --preserve-tests
pytest -xvs || exit 1
@project-scribe document optimization-session
```

## Complete Workflow Patterns

### New Project Setup (One-time)
```bash
# First-time setup with intelligent configuration
/optimize-setup
# → Detects: Python+FastAPI project with pytest and poetry
# → Customizes: 8 agents with FastAPI-specific context  
# → Creates: Project configuration and templates
# → Integrates: CLAUDE.md with optimization system documentation
# → Result: Complete optimization system ready for use
```

### Daily Development Cycle with Full Attribution
```bash
# After completing a feature (with existing setup)
git add .

# Run optimization analysis using customized agents
/optimize
# → Uses project-specific agents with FastAPI context
# → Creates issues.json with 8 findings including test impact
# → Generates detailed report with project-specific recommendations

# Review and make strategic decisions
/optimize-review
# User input: "Implement #1, #3, #8, gh-issue #2, #7, Defer #4, #5, #6, Skip #9, #10"
# → Generates commands.sh with test-first workflow
# → Creates 2 GitHub issues with optimization context
# → Defers 3 items to backlog with session tracking

# Execute test-driven improvements
bash .claude/optimize/pending/commands.sh
# → 1. Analyzes test impact using project test framework (pytest)
# → 2. Updates tests before refactoring using FastAPI patterns
# → 3. Implements changes with test safety guards
# → 4. Validates with project test command
# → 5. Documents successful changes with project context

# Commit with optimization attribution and session linking
/optimize-commit
# → Detects recent session: 20250902_143022
# → Generates commit: "optimize(20250902_143022): implement 3 FastAPI improvements (OPT-001,OPT-003,OPT-008)"
# → Links commit to optimization session bidirectionally
# → Updates session file with commit hash
# → Creates commit tracking file for audit trail

# Monitor system health and progress
/optimize-status
# → Shows: 3 implemented, 2 GitHub issues created, 3 deferred, 2 skipped
# → Displays: Recent commit attribution and session links
# → Provides: Next steps and system health status
```

### Pre-Release Quality Gate
```bash
# Comprehensive quality review before release
/optimize
/optimize-review
# → "Implement all critical, Implement all high, gh-issue all medium, Defer all low"
bash .claude/optimize/pending/commands.sh
/optimize-commit
# → "optimize(20250902_154530): implement pre-release quality improvements (8 issues)"

# Convert remaining medium-priority items to GitHub issues for next iteration
/optimize-gh-migrate
# → "Convert all --comment='Post-release quality improvements'"
```

### Technical Debt Sprint
```bash
# Review accumulated backlog from previous sessions
/optimize-status
# → Shows: 12 deferred issues from past sessions across 4 categories

# Implement accumulated technical debt
/optimize-review
# → "Implement all from backlog --comment='Tech debt sprint Q4'"
bash .claude/optimize/pending/commands.sh
/optimize-commit
# → "optimize(20250902_163015): resolve technical debt backlog (12 improvements)"
```

### Team Collaboration Workflow
```bash
# Team member setting up on existing project
/optimize-setup
# → Detects existing project configuration
# → Updates with local environment and agent availability
# → Customizes agents for team member's specific context

# Collaborative optimization session
/optimize
/optimize-review  
# → "Implement local items, gh-issue team items --comment='Needs review: @teamlead'"
bash .claude/optimize/pending/commands.sh
/optimize-commit
/optimize-gh-migrate
# → Creates GitHub issues for team coordination and review
```

### Emergency Security Response
```bash
# Quick security audit using security-focused agents
/optimize
# → Security-auditor agent (customized with project context) identifies vulnerabilities
# → Generates CRITICAL and HIGH priority security findings

/optimize-review  
# → "Implement all critical security, Implement all high security --comment='Emergency security patch'"

bash .claude/optimize/pending/commands.sh
# → Immediate implementation with security-focused test updates

/optimize-commit
# → "optimize(20250902_URGENT): emergency security fixes (OPT-001,OPT-003,OPT-007)"
# → Creates detailed commit message with security issue attribution
# → Links to security session for compliance audit trail
```

## Issue Categories and Priorities

### Categories
- **REFACTORING**: Code quality, performance, maintainability
- **ARCHITECTURE**: System design, patterns, API consistency  
- **TESTING**: Test coverage, quality assurance
- **SECURITY**: Vulnerabilities, best practices, compliance

### Priority Levels
- **CRITICAL**: Security vulnerabilities, system-breaking issues
- **HIGH**: Performance bottlenecks, architectural violations
- **MEDIUM**: Code quality improvements, missing tests
- **LOW**: Documentation, minor optimizations

## Advanced Features

### GitHub Integration
- **Issue Creation** - Structured GitHub issues with optimization context
- **Label Management** - Automatic labeling by priority and category
- **Backlog Migration** - Convert deferred items to project management issues
- **Tracking Integration** - Links optimization sessions to GitHub activity

### Decision Tracking
- **Historical Record** - Complete audit trail of all optimization decisions
- **Comment System** - Rich context for why decisions were made
- **Progress Metrics** - Quantitative tracking of optimization impact
- **Team Coordination** - Shareable reports for team alignment

### Safety Features
- **Isolated Structure** - No interference with existing Claude Code setup
- **Safe Cleanup** - `rm -rf .claude/optimize/` without affecting agents/commands
- **Test Validation** - Mandatory test passage before changes are documented
- **Rollback Support** - Easy recovery from problematic optimizations

## Advanced Usage

### Continuous Quality Gates
```bash
# Pre-commit hook integration
git add . && /optimize && /optimize-review && git commit
```

### Project Health Monitoring  
```bash
# Weekly quality review
/optimize-status
# Check backlog and trends

# Monthly cleanup
find .claude/optimize/ -name "*.md" -mtime +30 -delete
```

### Custom Issue Tracking
```bash
# Convert deferred issues to GitHub issues (safe read-only operation)
if [ -f .claude/optimize/backlog/deferred_issues.json ]; then
  cat .claude/optimize/backlog/deferred_issues.json | jq '.[] | "Title: \(.title)\nBody: \(.description)"'
else
  echo "No deferred issues found"
fi
```

## Integration with Development Workflow

### Git Integration
- Run `/optimize` after major feature completion
- Include optimization commits in feature branches
- Use `/optimize-status` in CI/CD health checks

### Documentation Sync
- **@project-scribe** automatically updates:
  - `CHANGELOG.md` with optimization improvements
  - `docs/PROJECT_REQUIREMENTS.md` with architecture changes
  - `docs/DEVELOPER_GUIDE.md` with technical updates
  - `src/*/CLAUDE.md` context files for AI agents

### Team Collaboration
- Share `.claude/optimize/reports/` for code review context
- Use `.claude/optimize/decisions/` for architectural decision records
- Archive `.claude/optimize/completed/` for project retrospectives

## Troubleshooting

### Common Issues

**"No pending issues found"**
- Run `/optimize` first to generate analysis

**Commands fail with permission errors** 
- Ensure bash commands are allowed in your environment
- Check file permissions on `.claude/optimize/` directory

**Subagent commands not executing**
- Verify subagent availability in your environment
- Check command syntax in `.claude/optimize/pending/commands.sh`

### Maintenance

**Safe Cleanup - Optimization Data Only:**
```bash
# Only remove optimization-specific files, preserve agents/commands
rm -rf .claude/optimize/

# This safely removes all optimization data while preserving:
# - .claude/agents/ (your agents)  
# - .claude/commands/ (your commands)
# - Any other .claude/ contents

echo "✅ Optimization data cleared, agents and commands preserved"
```

**Archive Old Data:**
```bash
mkdir -p archive/$(date +%Y%m)
mv .claude/optimize/completed/implemented_*.json archive/$(date +%Y%m)/ 2>/dev/null
mv .claude/optimize/reports/optimization_*.md archive/$(date +%Y%m)/ 2>/dev/null
mv .claude/optimize/decisions/review_*.md archive/$(date +%Y%m)/ 2>/dev/null
echo "✅ Old optimization data archived"
```

**Backup Decisions:**
```bash
cp -r .claude/optimize/decisions/ backup/optimization-decisions-$(date +%Y%m%d)/
```

### Recovery Procedures

**⚠️ CRITICAL: Data Loss Prevention and Recovery**

The `.claude/optimize/` directory contains all optimization session data and must be preserved. Accidental deletion results in complete loss of optimization history, decision records, and audit trails.

**Emergency Recovery After Directory Deletion:**

1. **Immediate Assessment:**
   ```bash
   # Check if directory exists
   ls -la .claude/optimize/ 2>/dev/null || echo "❌ Directory deleted - recovery needed"
   
   # Check for backup sources
   ls -la backup/optimization-decisions-*/ 2>/dev/null
   ls -la archive/ 2>/dev/null
   ```

2. **Directory Structure Restoration:**
   ```bash
   # Recreate required directory structure
   mkdir -p .claude/optimize/{pending,completed,decisions,backlog,reports}
   echo "✅ Directory structure restored"
   
   # Verify restoration
   find .claude/optimize -type d -exec ls -ld {} \;
   ```

3. **Data Recovery (if backups available):**
   ```bash
   # Restore from most recent backup
   cp -r backup/optimization-decisions-*/decisions/* .claude/optimize/decisions/ 2>/dev/null
   cp -r archive/*/optimization_*.md .claude/optimize/reports/ 2>/dev/null
   cp -r archive/*/implemented_*.json .claude/optimize/completed/ 2>/dev/null
   echo "✅ Available data restored from backups"
   ```

4. **Recovery Documentation:**
   ```bash
   # Create recovery session record
   cat > .claude/optimize/completed/recovery_session_$(date +%Y%m%d).json << 'EOF'
   {
     "session_id": "recovery_$(date +%Y%m%d)_data_loss",
     "session_date": "$(date +%Y-%m-%d)",
     "session_type": "RECOVERY_SESSION",
     "incident_type": "DIRECTORY_DELETION",
     "recovery_status": "COMPLETED",
     "data_recovery_status": "PARTIAL/COMPLETE",
     "notes": ["Manual recovery from accidental directory deletion"]
   }
   EOF
   echo "✅ Recovery session documented"
   ```

5. **System Validation:**
   ```bash
   # Test system functionality
   /optimize-status
   echo "✅ System functionality verified"
   ```

**Preventive Measures:**

- **Regular Backups:** Use the backup commands above before major operations
- **Version Control:** Keep `.claude/optimize/` in source control (excluding sensitive data)
- **Documentation:** Maintain CHANGELOG.md with all optimization session details
- **Monitoring:** Regular `/optimize-status` health checks

**Data Loss Impact Assessment:**
- **High Impact:** Complete loss of optimization audit trail and session history  
- **Medium Impact:** Loss of decision rationale and implementation tracking
- **Low Impact:** System functionality remains intact (implemented optimizations persist in code)

**Recovery Validation Checklist:**
- [ ] Directory structure restored
- [ ] Available backup data restored  
- [ ] Recovery session documented
- [ ] System functionality verified
- [ ] Preventive measures reviewed and implemented

### Safe Operations Only
All maintenance operations are designed to preserve your existing `.claude/` agents, commands, and configurations. The isolated `.claude/optimize/` structure ensures safe cleanup with `rm -rf .claude/optimize/` without affecting other files.

**⚠️ WARNING:** Never delete `.claude/optimize/` unless you have verified backups and understand the data loss implications. This directory contains irreplaceable optimization session data, audit trails, project-specific configuration, customized agent knowledge, and commit attribution history that cannot be recovered.

## Performance Expectations

- **Analysis Phase**: 30-60 seconds depending on codebase size
- **Review Phase**: Interactive, depends on user decision time
- **Implementation**: Varies by issue complexity and subagent response time
- **Documentation**: Automatic, 10-30 seconds for changelog updates

This system scales with your codebase and provides consistent quality assurance throughout your development lifecycle.
